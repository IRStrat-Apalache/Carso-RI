{% extends 'layouts/base.html' %}
{% load static %}

{% block otherstyles %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/fullcalendar/core/main.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'css/fullcalendar/daygrid/main.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'css/fullcalendar/timegrid/main.css' %}"/>
    <style>
        .calendar-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap; /* Permite que los elementos se acomoden mejor en móviles */
            position: relative; /* Aseguramos que todo esté dentro del contenedor */
        }
    
        .calendar {
            width: 400px;
            height: 350px;
            
            padding: 10px;
            text-align: center;
            font-family: Arial, sans-serif;
            position: relative;
        }
    
        .navigate-btn {
            cursor: pointer;
            padding: 10px;
            background-color: #59A971;
            color: white;
            border: none;
            font-size: 18px;
            border-radius: 5px;
            
        }

    
    
        /* Botones visibles solo en pantallas grandes */
        .desktop-btn {
            display: inline-block;
        }
    
        /* Estilo para el contenedor de los botones, centrado */
        .mobile-buttons {
            display: flex; /* Usamos flexbox para centrar los botones */
            justify-content: center; /* Centramos los botones horizontalmente */
            align-items: center; /* Alineamos los botones verticalmente */
            margin:10px;
        }
    
        /* Estilo para los botones, ocultos por defecto */
        .mobile-btn {
            display: none; /* Ocultamos los botones por defecto */
            font-size: 16px; /* Tamaño de fuente más pequeño */
            padding: 8px 12px; /* Reducción del tamaño del botón */
            margin: 0 8px; /* Margen horizontal entre los botones */
            border: none;
            background-color: #59A971; /* Fondo de los botones */
            color: white;
            border-radius: 5px; /* Para hacerlos circulares */
            cursor: pointer;
        }
    
    
        .event-list {
            margin-top: 20px;
        }
    
        /* Estilo para las listas de eventos */
        .event-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
        }
    
        .event-container h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
    
        ul {
            list-style-type: none;
            padding: 0;
        }
    
        .lista > li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background-color: #f4f4f4;
            border-radius: 5px;
        }

        
    
        .event-buttons {
            display: flex;
            gap: 10px;
        }
    
        /* Clases más específicas para evitar conflictos */
        .add-to-google-calendar-btn,
        .add-to-outlook-calendar-btn {
            font-size: 1.5rem;
            display: inline-block;
            padding: 8px;
            border-radius: 50%;
            background-color: #f1f1f1;
            color: #4CAF50;
            text-align: center;
        }
    
        .add-to-google-calendar-btn:hover,
        .add-to-outlook-calendar-btn:hover {           
            color: #23356B;            
        }
    
        /* Estilo para el tooltip */
        .tooltip {
            visibility: hidden;
            width: 150px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 100%; /* El tooltip aparece arriba del elemento */
            left: 50%;
            margin-left: -75px; /* Para centrar el tooltip */
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
    
        /* Mostrar el tooltip cuando se hace hover sobre el elemento */
        .calendar div:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        .modal {
            display: none; /* Ocultar por defecto */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
    
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #4CAF50;            
            max-width: 450px;
            width: 90%;
            margin:10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); 
        }
    
        .close-btn {
            background: transparent;
            border: none;
            color: #4CAF50;
            font-size: 25px;
            float: right;
            cursor: pointer;
            
        }

        .close-btn:hover{
            background:trasnparent;
            outline:none;
            color:#37753a;
        }
        
        /* Responsividad: Cuando el ancho de la pantalla es menor a 768px (móviles y tablets en modo retrato) */
        @media (max-width: 768px) {
            .calendar-container {
                display: flex; /* Usamos flexbox para organizar los calendarios */
                flex-direction: column; /* Colocamos los calendarios en columna */
                align-items: center; /* Centramos los calendarios */
                justify-content: flex-start; /* Los calendarios se alinean desde arriba */
                margin-top: 60px; /* Margen superior para evitar solapamiento con el encabezado */
            }
        
            .calendar {
                width: 100%; /* Hacemos que los calendarios ocupen todo el ancho disponible */
                margin-bottom: 20px; /* Separación entre calendarios */
            }
        
            /* Los botones de escritorio deben seguir ocultos */
            .desktop-btn {
                display: none !important; /* Los botones tradicionales se ocultan en dispositivos móviles */
            }
        
            .mobile-btn {
                display: inline-block; /* Mostramos los botones en pantallas móviles */
            }
            
        }

    </style>
    
    
{% endblock %}

{% block content %}
    <div class="">

        <!-- Botones de navegación solo para móviles -->
        <div class="text-center justify-content-center mobile-buttons">
            <button class="navigate-btn mobile-btn" onclick="navigateMonths(-1)">&#10094;</button>
            <button class="navigate-btn mobile-btn" onclick="navigateMonths(1)">&#10095;</button>
        </div>

        <div class="calendar-container">
            <button class="navigate-btn desktop-btn" onclick="navigateMonths(-1)">&#10094;</button>
            <div id="calendar1" class="calendar"></div>
            <div id="calendar2" class="calendar"></div>
            <div id="calendar3" class="calendar"></div>
            <button class="navigate-btn desktop-btn" onclick="navigateMonths(1)">&#10095;</button>
        </div>
        
        <!-- Contenedor para los eventos -->
        <div class="event-container container">
            <h3 class="mt-3">Eventos Próximos</h3>
            <ul id="upcomingEvents" class="lista"></ul>
        
            <h3>Eventos Pasados</h3>
            <ul id="pastEvents"></ul>
        </div>
        <div class="container">
            <div class="row mb-5">
                <div class="col-6">
                    <h2 style="color:#23356B">¿Quieres que nos reunamos?</h2>
                </div>
                <div class="col-6">                
                    <h5>Contáctanos en: angie.ramos@fibraeduca.com</h5>
                    <h5>Tel: +52 55 2303 5667 / +52 56 5107 7692</h5>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div>
                <button id="closeModal" class="close-btn text-right">&times;</button>
                <div id="modalBody">
                    <!-- Aquí irá el contenido dinámico -->
                </div>
            </div>
        </div>
    </div>




{% endblock %}
{% block otherscripts %}
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js"></script>
    

    <script src="{% static 'js/fullcalendar/core/main.js' %}"></script>
    <script src="{% static 'js/fullcalendar/core/locales-all.js' %}"></script>
    <script src="{% static 'js/fullcalendar/interaction/main.js' %}"></script>
    <script src="{% static 'js/fullcalendar/daygrid/main.js' %}"></script>
    <script src="{% static 'js/fullcalendar/timegrid/main.js' %}"></script>
    
    <script>        
        let currentMonthDate = new Date();  // Fecha actual
        const events = [
            { title: 'REITworld: 2024 Annual Conference', start: '18/11/2024', end: '21/11/2024',  },            
            { title: 'Nareit REITworld: 2024 Annual Conference', start: '20/11/2024', end: '20/11/2024' },            
            { title: 'BMV: Coctel de emisoras', start: '28/11/2024', end: '28/11/2024' },            
            { title: 'UBS: Global Real Estate Conference', start: '03/12/2024', end: '04/12/2024', link:'https://www.linkedin.com/posts/fibraeduca_el-d%C3%ADa-de-ayer-nuestro-ceo-raul-martinezsolares-activity-7265725754942910464-jlkb?utm_source=share&utm_medium=member_ios' },            
            { title: 'UBS Global Real Estate CEO/CFO Conference 2024', start: '04/12/2024', end: '04/12/2024' },
            { title: 'Santander: XXIX Conferencia Santander México', start: '15/01/2025', end: '16/01/2025' },
            { title: 'CEO Forum & Advocacy Day', start: '25/02/2025', end: '26/02/2025' },
            { title: 'REITwise 2025 Law, Accounting & Finance Conference', start: '25/03/2025', end: '27/03/2025' },
            { title: 'REITweek: 2025 Investor Conference', start: '02/06/2025', end: '05/06/2025' },
            { title: '2025 REIT Investor Relations Symposium', start: '02/06/2025', end: '02/06/2025' },
            { title: 'REITworld: 2025 Annual Conference', start: '08/12/2025', end: '11/12/2025' },
            { title: 'REITwise: 2026 Law, Accounting & Finance Conference', start: '24/03/2026', end: '26/03/2026' },
        ];


        // Obtener la fecha actual
        const currentDate = new Date();

        // Función para dividir los eventos en pasados y próximos
        function divideEvents() {
            const upcomingEvents = [];
            const pastEvents = [];

            events.forEach(event => {
                const eventDate = parseDate(event.start);
                if (eventDate >= currentDate) {
                    upcomingEvents.push(event);
                } else {
                    pastEvents.push(event);
                }
            });

            displayEvents(upcomingEvents, 'upcomingEvents');
            displayEvents(pastEvents, 'pastEvents');
        }

        // Función para parsear las fechas en formato DD/MM/YYYY
        function parseDate(dateString) {
            const [day, month, year] = dateString.split('/');
            return new Date(`${month}/${day}/${year}`);
        }

        // Función para mostrar eventos en el DOM
        function displayEvents(eventsList, listId) {
            const listEl = document.getElementById(listId);
            listEl.innerHTML = '';
        
            eventsList.forEach(event => {
                const listItem = document.createElement('li');
                listItem.textContent = `${event.title} - ${event.start}`; // Mostrar título y fecha
        
                const buttonsDiv = document.createElement('div');
                buttonsDiv.classList.add('event-buttons');
        
                if (listId === 'upcomingEvents') {
                    const googleButton = document.createElement('a');
                    googleButton.href = createGoogleCalendarLink(event);
                    googleButton.target = "_blank";
                    googleButton.classList.add('add-to-google-calendar-btn');
                    googleButton.innerHTML = '<i class="fa fa-google"></i>';
        
                    const outlookButton = document.createElement('a');
                    outlookButton.href = createOutlookCalendarLink(event);
                    outlookButton.target = "_blank";
                    outlookButton.classList.add('add-to-outlook-calendar-btn');
                    outlookButton.innerHTML = '<i class="fa fa-calendar"></i>';
        
                    buttonsDiv.appendChild(googleButton);
                    buttonsDiv.appendChild(outlookButton);
                }
        
                listItem.appendChild(buttonsDiv);
                listEl.appendChild(listItem);
            });
        }
        

        // Función para crear el enlace de Google Calendar
        function createGoogleCalendarLink(event) {
            const startDate = formatDateForGoogleCalendar(event.start);
            const endDate = formatDateForGoogleCalendar(event.end);
            return `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(event.title)}&dates=${startDate}%2F${endDate}&details=${encodeURIComponent(event.title)}&location=&sf=true&output=xml`;
        }
        

        // Función para crear el enlace de Outlook Calendar
        function createOutlookCalendarLink(event) {
            const startDate = formatDateForOutlook(event.start);
            const endDate = formatDateForOutlook(event.end);
            return `https://outlook.live.com/calendar/0/deeplink/compose?subject=${encodeURIComponent(event.title)}&startdt=${startDate}&enddt=${endDate}&body=${encodeURIComponent(event.title)}`;
        }
        

        // Formatear la fecha para Google Calendar (YYYYMMDDTHHmmssZ)
        function formatDateForGoogleCalendar(dateString) {
            const [day, month, year] = dateString.split('/');
            return `${year}${month}${day}T120000Z`; // Formato UTC
        }

        // Formatear la fecha para Outlook Calendar (ISO 8601)
        function formatDateForOutlook(dateString) {
            const [day, month, year] = dateString.split('/');
            return `${year}-${month}-${day}T12:00:00Z`; // Formato ISO 8601
        }

        // Llamar la función para dividir los eventos y mostrarlos
        divideEvents();

        
        // Función para convertir una fecha al formato DD/MM/YYYY
        function formatDateToDDMMYYYY(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // Inicializamos las fechas de los calendarios
        let calendar1Date = new Date(currentMonthDate.getFullYear(), currentMonthDate.getMonth(), 1); // Mes actual
        let calendar2Date = new Date(currentMonthDate.getFullYear(), currentMonthDate.getMonth() + 1, 1); // Un mes después
        let calendar3Date = new Date(currentMonthDate.getFullYear(), currentMonthDate.getMonth() + 2, 1); // Dos meses después
        
        // Inicializar los calendarios
        initializeCalendars();
        
        // Función para inicializar los tres calendarios
        function initializeCalendars() {
            renderCalendar('calendar1', calendar1Date);
            renderCalendar('calendar2', calendar2Date);
            renderCalendar('calendar3', calendar3Date);
            updateEventList();
        }
        
        function renderCalendar(calendarId, date) {
            const calendarEl = document.getElementById(calendarId);
            calendarEl.innerHTML = ''; // Limpiar el contenido del calendario
        
            const monthName = date.toLocaleString('es-ES', { month: 'long' });
            const capitalizedMonthName = monthName.charAt(0).toUpperCase() + monthName.slice(1);
            const year = date.getFullYear();
            const daysInMonth = new Date(year, date.getMonth() + 1, 0).getDate();
        
            // Título del mes
            const title = document.createElement('h3');
            title.textContent = `${capitalizedMonthName} ${year}`;
            calendarEl.appendChild(title);
        
            const line = document.createElement('hr');
            line.style.border = '1px solid #4CAF50';
            calendarEl.appendChild(line);
        
            const daysOfWeekContainer = document.createElement('div');
            daysOfWeekContainer.style.display = 'grid';
            daysOfWeekContainer.style.gridTemplateColumns = 'repeat(7, 1fr)';
            daysOfWeekContainer.style.fontWeight = 'bold';
        
            const daysOfWeek = ['L', 'M', 'M', 'J', 'V', 'S', 'D'];
            daysOfWeek.forEach(day => {
                const dayEl = document.createElement('div');
                dayEl.textContent = day;
                dayEl.style.textAlign = 'center';
                daysOfWeekContainer.appendChild(dayEl);
            });
            calendarEl.appendChild(daysOfWeekContainer);
        
            const daysContainer = document.createElement('div');
            daysContainer.style.display = 'grid';
            daysContainer.style.gridTemplateColumns = 'repeat(7, 1fr)';
            calendarEl.appendChild(daysContainer);
        
            const firstDay = (new Date(year, date.getMonth(), 1).getDay() + 6) % 7;
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                daysContainer.appendChild(emptyCell);
            }
        
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.textContent = day;
                dayCell.style.padding = '10px';
                dayCell.style.textAlign = 'center';
                dayCell.style.cursor = 'pointer';
                dayCell.style.border = '1px solid #ddd';
                dayCell.style.position = 'relative';
        
                const formattedDate = formatDateToDDMMYYYY(new Date(year, date.getMonth(), day));
        
                const eventsOnThisDay = events.filter(event => event.start === formattedDate);
                if (eventsOnThisDay.length > 0) {
                    const marker = document.createElement('div');
                    marker.style.width = '8px';
                    marker.style.height = '8px';
                    marker.style.borderRadius = '50%';
                    marker.style.backgroundColor = 'blue';
                    marker.style.position = 'absolute';
                    marker.style.bottom = '5px';
                    marker.style.left = '50%';
                    marker.style.transform = 'translateX(-50%)';
                    dayCell.appendChild(marker);
        
                    dayCell.addEventListener('click', () => {
                        openModal(eventsOnThisDay); // Abre el modal con la información del evento
                    });
                }
        
                daysContainer.appendChild(dayCell);
            }
        }
        
        function openModal(events) {
            const modal = document.getElementById('eventModal');
            const modalBody = document.getElementById('modalBody');
        
            modalBody.innerHTML = ''; // Limpiar contenido previo
        
            events.forEach(event => {
                // Título del evento
                const title = document.createElement('h4');
                title.textContent = event.title;
                title.style.fontSize = '1.5rem'; // Aumentar tamaño del texto
                title.style.marginBottom = '10px';
                title.style.color = '#23356B';
                title.style.fontWeight = 'bold';
        
                // Detalles del evento
                const details = document.createElement('p');
                details.textContent = `Inicio: ${event.start}, Fin: ${event.end}`;
                details.style.marginBottom = '15px';
                details.style.color = '#4CAF50';
        
                modalBody.appendChild(title);
                modalBody.appendChild(details);
        
                // Enlace de la presentación
                if (event.link) {
                    const linkWrapper = document.createElement('div');
                    linkWrapper.style.marginTop = '10px';
                    linkWrapper.style.backgroundColor = '#23356B';
                    linkWrapper.style.borderRadius = '5px';
                    linkWrapper.style.width = '50%';
                    linkWrapper.style.justifyContent = 'center';
                    linkWrapper.style.display = 'flex'; // Usar flexbox para centrar
                    linkWrapper.style.alignItems = 'center'; // Alinear elementos verticalmente
                    linkWrapper.style.padding = '10px'; // Agregar algo de espacio interno para que no estén pegados al borde
                    linkWrapper.style.marginBottom = '10px';

                    const icon = document.createElement('i');
                    icon.className = 'fa fa-file-pdf-o'; // Requiere Font Awesome
                    icon.style.color = 'white'; // Color del icono
                    icon.style.marginRight = '10px'; // Espacio entre el icono y el texto
                    icon.style.fontSize = '1.5rem'; // Aumentar tamaño del ícono
                    
                    const link = document.createElement('a');
                    link.href = event.link;
                    link.target = '_blank';
                    link.textContent = 'Presentación';
                    link.style.textDecoration = 'none';
                    link.style.color = 'white'; // Color del texto
                    link.style.fontSize = '1.2rem'; // Aumentar tamaño del texto
                    
                    linkWrapper.appendChild(icon);
                    linkWrapper.appendChild(link);
                
                    modalBody.appendChild(linkWrapper);
                }
                
            });
        
            modal.style.display = 'flex'; // Mostrar modal
        }
        
        
        
        // Función para navegar entre meses
        function navigateMonths(direction) {
            // Modificar la fecha de los calendarios
            calendar1Date.setMonth(calendar1Date.getMonth() + direction);
            calendar2Date.setMonth(calendar2Date.getMonth() + direction);
            calendar3Date.setMonth(calendar3Date.getMonth() + direction);
            
            // Volver a renderizar los calendarios con las nuevas fechas
            renderCalendar('calendar1', calendar1Date);
            renderCalendar('calendar2', calendar2Date);
            renderCalendar('calendar3', calendar3Date);
            
            // Actualizar la lista de eventos después de cambiar el mes
            updateEventList();
        }

        
        
        // Función para comparar las fechas en formato DD/MM/YYYY
        function compareDates(eventStart, eventEnd, calendarDate) {
            const startDate = parseDate(eventStart);
            const endDate = parseDate(eventEnd);
            const targetDate = parseDate(calendarDate);
            return targetDate >= startDate && targetDate <= endDate;
        }
        
        
        // Función para actualizar la lista de eventos
        function updateEventList() {
            const eventListEl = document.getElementById('eventList');
            eventListEl.innerHTML = '';  // Limpiar la lista de eventos
            
            events.forEach(event => {
                const listItem = document.createElement('li');
                
                // Usamos la fecha del evento tal cual está almacenada
                const formattedDate = event.start;  // Ya está en el formato DD/MM/YYYY
                
                // Mostrar el título del evento y la fecha
                listItem.textContent = `${event.title} - ${formattedDate}`;
                eventListEl.appendChild(listItem);
            });
        }
        

    </script>

    <script>
        // Cerrar el modal
        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('eventModal').style.display = 'none';
        });
    </script>
{% endblock %}
